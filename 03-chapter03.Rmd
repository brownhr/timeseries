

# Rolling and Expanding Windows

## Rolling Window

- Moving lower and upper bound


### Data



<!-- ```{r} -->
<!-- library(tsbox) -->

<!-- dl_dplyr <- cran_data %>% -->
<!--   # filter(date >= as.Date("2018-01-01")) %>%  -->
<!--   select(-package) -->

<!-- # tsbox::ts_ts() parses the Date column in a much easier way, making the -->
<!-- # conversion process easy to interpret -->
<!-- dl_ts <- dl_dplyr %>% -->
<!--   tsbox::ts_ts() -->

<!-- autoplot(dl_ts) -->
<!-- ``` -->


### Calculating a Rolling Window

<!-- ```{r} -->
<!-- dl_dplyr_rolling <- dl_dplyr %>% -->
<!--   tq_mutate( -->
<!--     select = count, -->
<!--     mutate_fun = rollapplyr, -->
<!--     FUN = mean, -->
<!--     width = 7, -->
<!--     col_rename = "weekly_avg" -->
<!--   ) %>% -->
<!--   tq_mutate( -->
<!--     select = count, -->
<!--     mutate_fun = rollapplyr, -->
<!--     FUN = mean, -->
<!--     width = 30, -->
<!--     col_rename = "monthly_avg" -->
<!--   ) -->

<!-- weekly_ts <- dl_dplyr_rolling %>% -->
<!--   select(date, weekly_avg) %>% -->
<!--   ts_ts() -->
<!-- ``` -->

<!-- ```{r} -->
<!-- ggplot() + -->
<!--   geom_line(data = dl_dplyr, mapping = aes(x = date, y = count), color = "grey50") + -->
<!--   geom_line(data = dl_dplyr_rolling, mapping = aes(x = date, y = weekly_avg), color = "red") -->
<!-- ``` -->


<!-- ```{r} -->
<!-- dl_rolling_ts <- dl_dplyr_rolling %>% -->
<!--   select( -->
<!--     date, weekly_avg -->
<!--   ) %>% -->
<!--   ts_ts() -->

<!-- dl_rolling_ts %>% -->
<!--   decompose(type = "multiplicative") %>% -->
<!--   autoplot() -->
<!-- ``` -->


<!-- # Expanding Window -->

<!-- - Fixed lower bound -->
<!-- - Moving upper bound -->

<!-- ```{r} -->

<!-- dl_expand <- dl_dplyr %>%  -->
<!--   mutate( -->
<!--     mean_expand = cummean(count), -->
<!--     cum_sum = cumsum(count) -->
<!--   ) -->

<!-- expand_ts <- dl_expand %>%  -->
<!--   select(date, mean_expand) %>%  -->
<!--   ts_ts() -->
<!-- ``` -->

<!-- ```{r} -->
<!-- ggplot() + -->
<!--   geom_line(data = dl_dplyr, aes(x = date, y = count), color = "gray50") + -->
<!--   geom_line(data = dl_expand, aes(x = date, y = mean_expand), color = "red") +  -->
<!--   geom_line(data = dl_dplyr_rolling, aes(x = date, y = weekly_avg), color = "blue") +  -->
<!--   geom_line(data = dl_dplyr_rolling, aes(x = date, y = monthly_avg), color = "green") +  -->
<!--   theme_light() -->
<!-- ``` -->

